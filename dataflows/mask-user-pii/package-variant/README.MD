# Mask User PII - Package Variant

The package variant of the `mask-user-pii` dataflow, imports a function from the [mask-ssn](../../../packages/mask-ssn/README.MD) and applies it to the dataflow.

The following diagram is a visual representation of these operations generated by `sdf`:

<p align="center">
 <img width="600" src="../img/mask-user-pii.jpg">
</p>


## Step-by-step

Take a look at the [dataflow.yaml](./dataflow.yaml) to see how we've implemented it.

### Compile the Package

Use the following command to compile the package:

```bash
(cd ../../../packages/mask-ssn && sdf build)
```

### Run the Dataflow

Use `sdf` command line tool to run the dataflow:

```bash
sdf run --dev --ui
```

Where:
  * `--dev` - runs the dataflow in development mode (reads the package from local file system).
  * `--ui` - generates the graphical representation and run the Studio web server.


### Test the Dataflow

The sample data file used to run this test `../sample-data/data.txt` has the following records:

```json
{"name": "Alice", "ssn": "555-12-1212"}
{"name": "Bob", "ssn": "123-45-6789"}
```

Produce the data to in `user-info` topic:

```bash
fluvio produce user-info -f ./sample-data/data.txt
```

Checkout the data in `user-info` topic:

```bash
fluvio consume user-info -Bd
```

Consume from `masked` to retrieve the result:

```bash
fluvio consume masked -Bd
```

```json
{"name": "Alice", "ssn": "***-**-****"}
{"name": "Bob", "ssn": "***-**-****"}
```


## Clean-up

Exit `sdf` terminal and clean-up. The `--force` flag removes the topics:

```bash
sdf clean --force
```

### References

* [Deploy a Dataflow in Production](https://www.fluvio.io/sdf/deployment)
